<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>本地Service</title>
    <!--格式化代码的特效脚本-->
    <script type="text/javascript" src="scripts/shCore.js"></script>
    <script type="text/javascript" src="scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
    <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
    <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
    <script type="text/javascript" src="scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
    <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
    <script type="text/javascript" src="scripts/shBrushScala.js"></script>
    <script type="text/javascript" src="scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="scripts/shBrushVb.js"></script>
    <script type="text/javascript" src="scripts/shBrushXml.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/shCoreZenki.css"/>
    <link type="text/css" rel="stylesheet" href="styles/shThemeZenki.css"/>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
	<link type="text/css" rel="stylesheet" href="css_style/style_zenki.css"/>

</head>

<body>
<div id="wrapper">
<header>

<div id="logo">
</div>

<nav>
    <ul>
        <!--<li class="first"><a href="diary/diary.html">日记</a></li>-->
     </ul>
</nav>
</header>

<article>


<h1 id="toc_1">本地Service</h1>

<h2 id="toc_1.1">Binding Service</h2>

<h3 id="toc_1.1.1">client端</h3>

<ul>
<li>
需要实现ServiceConnection接口的两个方法：<code>onServiceConnected</code>和<code>onServiceDisconnected</code>，用来监控Service的状态，该方法通过IBinder参数获取服务端方法。
</li>
<li>
通过bindService进行绑定
</li>
<li>
通过unbindService解除绑定
</li>
</ul>

<p>
例程源码(JAVA) --- ServiceConnection
</p>
<pre class="brush:java">
private ILocalService mBoundService;

private ServiceConnection mConnection = new ServiceConnection() {
    public void onServiceConnected(ComponentName className, IBinder service) {
        // 当与Service建立连接时，会调用此方法
        mBoundService = (ILocalService) service;
    }

    public void onServiceDisconnected(ComponentName className) {
        // 当与连接断开时，会调用此方法
        mBoundService = null;
    }
};
</pre>

<p>
例程源码(JAVA) --- bindService和unbindService
</p>
<pre class="brush:java">
bindService(new Intent(LocalServiceBinding.this, 
            LocalService.class), mConnection, Context.BIND_AUTO_CREATE);

unbindService(mConnection);
</pre>

<h3 id="toc_1.1.2">Service端</h3>

<ul>
<li>
从Service类派生对象，实现onCreate，onDestroy和onBind方法。
</li>
<li>
从Binder类派生对象，该类可以实现一个自定义的接口，用户可以在这里实现接口的方法，之后客户端通过该接口调用该方法。
</li>
<li>
onCreate在启动Service时调用。
</li>
<li>
onDestroy在销毁Service时调用。
</li>
<li>
onBind在onCreate之后调用，将会返回给客户端一个IBinder接口，客户端通过该接口通信。
</li>
</ul>

<p>
例程源码(JAVA) --- 自定义接口
</p>
<pre class="brush:java">
interface ILocalService {
    int getCount();
}
</pre>
<p>
例程源码(JAVA) --- Service
</p>
<pre class="brush:java">
private NotificationManager mNM;

private LocalBinder mBinder = new LocalBinder();

// 派生Binder类
public class LocalBinder extends Binder implements ILocalService {
    // 实现接口的方法
    int getCount() {
        return 100;
    }
}

@Override
public void onCreate() {
    // do some thing
}

@Override
public void onDestroy() {
    // do some thing
}

@Override
public IBinder onBind(Intent intent) {
    // 返回Binder对象
    return mBinder;
}

@Override
public boolean onUnbind(Intent intent) {
    return true;
}
</pre>

<h2 id="toc_1.2">Start Service</h2>
<h3 id="toc_1.2.1">client端</h3>

<ul>
<li>
startService用来启动一个Service
</li>
<li>
stopService用来停止一个Service
</li>
</ul>

<p>
例程源码(JAVA)
</p>
<pre class="brush:java">
startService(new Intent(LocalServiceController.this, LocalService.class));

stopService(new Intent(LocalServiceController.this, LocalService.class));
</pre>

<h3 id="toc_1.2.2">Service端</h3>

<ul>
<li>
旧方法<code>onStart</code>和新方法<code>onStartCommand</code>将在每次执行startService时调用，而onCreate只调用一次
</li>
<li>
参见Binding Service
</li>
</ul>

<p>
例程源码(JAVA)
</p>
<pre class="brush:java">
@Override
public void onStart(Intent intent, int startId) {
    handleCommand(intent);
}

@Override
public int onStartCommand(Intent intent, int flags, int startId) {
    handleCommand(intent);
    // We want this service to continue running until it is explicitly
    // stopped, so return sticky.
    return START_STICKY;
}
</pre>

<h2 id="toc_1.3">Manifest</h2>
<ul>
<li>
在xml中添加Service服务
</li>
</ul>

<p>
例程源码(XML)
</p>
<pre class="brush:xml">
&lt;service android:name=".LocalService" /&gt;
</pre>
<footer>
    <a href="index.html" id="back-home">首页</a>
    <a href="index.html" id="back-about">关于</a>
    <a href="http://www.163.com/" id="back-email">Email</a>
</footer>

</article>
</div>

<!--<script type="text/javascript">-->
<!--var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");-->
<!--document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));-->
<!--</script>-->
<!--<script type="text/javascript">-->
<!--try {-->
<!--var pageTracker = _gat._getTracker("UA-15922433-1");-->
<!--pageTracker._trackPageview();-->
<!--} catch(err) {}-->
<!--</script>-->

</body>
</html>
