<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>XmlPullParser解析文件</title>
    <!--格式化代码的特效脚本-->
    <script type="text/javascript" src="scripts/shCore.js"></script>
    <script type="text/javascript" src="scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
    <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
    <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
    <script type="text/javascript" src="scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
    <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
    <script type="text/javascript" src="scripts/shBrushScala.js"></script>
    <script type="text/javascript" src="scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="scripts/shBrushVb.js"></script>
    <script type="text/javascript" src="scripts/shBrushXml.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/shCoreZenki.css"/>
    <link type="text/css" rel="stylesheet" href="styles/shThemeZenki.css"/>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
    <link rel="Stylesheet" type="text/css" href="../css_style/style_zenki.css">

</head>

<body>
<div id="wrapper">
<header>

<div id="logo">
</div>

<nav>
    <ul>
        <!--<li class="first"><a href="diary/diary.html">日记</a></li>-->
     </ul>
</nav>
</header>

<article>

<!-- wrap the vimwiki html -->

<h1 id="toc_1">XmlPullParser解析</h1>

<h2 id="toc_1.1">相关类</h2>
<pre class="brush:java">
import org.xmlpull.v1.XmlPullParser;
import org.xmlpull.v1.XmlPullParserException.html;
import org.xmlpull.v1.XmlPullParserFactory;
import android.util.Xml;
</pre>

<h2 id="toc_1.2">基本处理流程</h2>
<ul>
<li>
使用XmlPullParserFactory.newInstance()方法生成<code>XmlPullParserFactory</code>对象工厂实例。

<li>
通过XmlPullParserFactory对象的newPullParser()方法生成<code>XmlPullParser</code>对象，该对象用来处理xml数据。

<li>
通过XmlPullParser对象的<code>setInput()</code>方法读取数据流，并通过<code>getEventType()</code>方法和<code>next()</code>方法遍历整个xml模型树。

</ul>

<h2 id="toc_1.3">EventType类型</h2>
<p>
getEventType()和next()方法返回读取到的xml数据类型，用户根据该数据的类型进行相应的处理
<table>
<tr>
<th>
类型标识
</th>
<th>
值
</th>
<th>
描述
</th>
</tr>
<tr>
<td>
START_DOCUMENT
</td>
<td>
0
</td>
<td>
文档起始标识
</td>
</tr>
<tr>
<td>
END_DOCUMENT
</td>
<td>
1
</td>
<td>
文档结束标识
</td>
</tr>
<tr>
<td>
START_TAG
</td>
<td>
2
</td>
<td>
标签开始标识
</td>
</tr>
<tr>
<td>
END_TAG
</td>
<td>
3
</td>
<td>
标签结束标识
</td>
</tr>
<tr>
<td>
TEXT
</td>
<td>
4
</td>
<td>
文本内容标识
</td>
</tr>
</table>
</p>

<h2 id="toc_1.4">示例程序</h2>
<pre class="brush:java">
public static List&lt;Person&gt; ReadXmlByPull (InputStream inputStream) throws Exception {
    List &lt;Person&gt; personList = null;
    /**
     * 通过对象工厂创建XmlPullParser对象
     */
    XmlPullParser xmlpull = Xml.newPullParser();
    XmlPullParserFactory factory = XmlPullParserFactory.newInstance();
    factory.setNamespaceAware(true);
    XmlPullParser xpp = factory.newPullParser();

    /**
     * 传入输入流并设定编码方式
     */
    xmlpull.setInput(inputStream, "utf-8");
    
    /**
     * pull读到xml后 返回数字
     * 读取到xml的声明返回START_DOCUMENT 0
     * 读取到xml的结束返回END_DOCUMENT   1  
     * 读取到xml的开始标签返回START_TAG  2
     * 读取到xml的结束标签返回END_TAG    3
     * 读取到xml的文本返回TEXT           4
     */
    int eventCode = xmlpull.getEventType();
    
    /**
     * 只要这个事件返回的不是1 我们就一直读取xml文件
     */
    Person person = null;
    while(eventCode!=XmlPullParser.END_DOCUMENT) {
        switch (eventCode) {
            // 开始文档时创建数据列表
            case XmlPullParser.START_DOCUMENT:
            {   
                personList =new  ArrayList&lt;Person&gt;();
                break;
            }
            
            // 标签开始时创建数据项
            case XmlPullParser.START_TAG:
            {
                if("person".equals(xmlpull.getName())) {
                    person =  new Person();
                    person.setId(xmlpull.getAttributeValue(0));
                }
                else if (person!=null) {
                    if(("name".equals(xmlpull.getName()))) {
                        /**
                         * 如果当前元素的下一个元素是文本节点 就可以直接用nextText()这个方法来得到文本节点的内容
                         */
                        person.setName(xmlpull.nextText());
                    }
                    else if ("age".equals(xmlpull.getName())) {
                        /**
                         * 如果当前元素的下一个元素是文本节点 就可以直接用nextText()这个方法来得到文本节点的内容
                         */
                        person.setAge(xmlpull.nextText());
                    }
                }
                break;
            }
                
            // 标签结束时加入数据项到列表
            case XmlPullParser.END_TAG:
            { 
                if("person".equals(xmlpull.getName())&amp;&amp;person!=null) {
                    personList.add(person);
                    person = null;
                }
                break;
            }
        }
        
        //没有结束xml文件就进行下一个解析
        eventCode = xmlpull.next();
    }
    
    return personList;
}
</pre>


<footer>
    <a href="index.html" id="back-home">首页</a>
    <a href="index.html" id="back-about">关于</a>
    <a href="http://www.163.com/" id="back-email">Email</a>
</footer>

</article>
</div>

</body>
</html>
