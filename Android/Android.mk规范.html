<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Android.mk规范</title>
    <!--格式化代码的特效脚本-->
    <script type="text/javascript" src="scripts/shCore.js"></script>
    <script type="text/javascript" src="scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
    <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
    <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
    <script type="text/javascript" src="scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
    <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
    <script type="text/javascript" src="scripts/shBrushScala.js"></script>
    <script type="text/javascript" src="scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="scripts/shBrushVb.js"></script>
    <script type="text/javascript" src="scripts/shBrushXml.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/shCoreZenki.css"/>
    <link type="text/css" rel="stylesheet" href="styles/shThemeZenki.css"/>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
	<link type="text/css" rel="stylesheet" href="css_style/style_zenki.css"/>

</head>

<body>
<div id="wrapper">
<header>

<div id="logo">
</div>

<nav>
    <ul>
        <!--<li class="first"><a href="diary/diary.html">日记</a></li>-->
     </ul>
</nav>
</header>

<article>


<h1 id="toc_1">Android.mk规范</h1>

<div class="toc">
<ul>
<li><a href="#toc_1">Android.mk规范</a></li>
<ul>
<li><a href="#toc_1.1">通用变量</a></li>
<li><a href="#toc_1.2">编译C模块</a></li>
<ul>
<li><a href="#toc_1.2.1">路径说明</a></li>
<li><a href="#toc_1.2.2">编译动作</a></li>
</ul>
<li><a href="#toc_1.3">编译Java模块</a></li>
<ul>
<li><a href="#toc_1.3.1">编译动作</a></li>
</ul>
<li><a href="#toc_1.4">编译APK</a></li>
<li><a href="#toc_1.5">示例代码</a></li>
<ul>
<li><a href="#toc_1.5.1">编译C静态库</a></li>
<li><a href="#toc_1.5.2">编译C动态库</a></li>
<li><a href="#toc_1.5.3">使用C静态库</a></li>
<li><a href="#toc_1.5.4">使用C动态库</a></li>
<li><a href="#toc_1.5.5">编译Jar库</a></li>
<ul>
<li><a href="#toc_1.5.5.1">编译jar库</a></li>
<li><a href="#toc_1.5.5.2">需要编写jar包路径的XML</a></li>
</ul>
<li><a href="#toc_1.5.6">编译apk</a></li>
</ul>
</ul>
</ul>
</div>

<h2 id="toc_1.1">通用变量</h2>
<dl>
<dt>LOCAL_PATH := $(call my-dir) </dt>
<dd>根路径</dd>
</dl>

<dl>
<dt>include $(CLEAR_VARS) </dt>
<dd>清除变量</dd>
</dl>

<dl>
<dt>include $(subdir_makefiles) </dt>
<dd>包含所有子makefile文件</dd>
</dl>

<dl>
<dt>include $(call all-subdir-makefiles) </dt>
<dd>执行所有子目录的makefile文件</dd>
</dl>

<dl>
<dt>include $(call all-makefiles-under, $(LOCAL_PATH)) </dt>
<dd>执行某目录下的所有makefile文件</dd>
</dl>

<h2 id="toc_1.2">编译C模块</h2>
<dl>
<dt>LOCAL_LDLIBS := </dt>
<dd>包含库</dd>
</dl>

<dl>
<dt>LOCAL_SHARED_LIBRARIES := </dt>
<dd>包含共享库</dd>
</dl>

<dl>
<dt>LOCAL_STATIC_LIBRARIES := </dt>
<dd>包含静态库</dd>
</dl>

<dl>
<dt>LOCAL_SRC_FILES := </dt>
<dd>源文件路径</dd>
</dl>

<dl>
<dt>LOCAL_C_INCLUDES += $(JNI_H_INCLUDE) </dt>
<dd>头文件路径</dd>
</dl>

<dl>
<dt>LOCAL_MODULE := </dt>
<dd>模块名称</dd>
</dl>

<dl>
<dt>LOCAL_MODULE_TAGS := eng </dt>
<dd>标示模块信息</dd>
</dl>

<dl>
<dt>LOCAL_MODULE_PATH := $(TARGET_OUT) </dt>
<dd>目标安装路径</dd>
</dl>

<dl>
<dt>LOCAL_PRELINK_MODULE := false </dt>
<dd>是否执行预编译</dd>
</dl>

<ul>
<li>
相关变量设置参见<a href="Build环境变量.html">Build环境变量</a>
</li>
</ul>

<h3 id="toc_1.2.1">路径说明</h3>
<dl>
<dt>TARGET_OUT_SHARED_LIBRARIES </dt>
<dd>共享库目录 out/target/product/generic/system/lib</dd>
</dl>

<dl>
<dt>TARGET_ROOT_OUT </dt>
<dd>根文件路径 out/target/product/generic/root</dd>
</dl>

<dl>
<dt>TARGET_OUT </dt>
<dd>system文件路径 out/target/product/generic/system</dd>
</dl>

<dl>
<dt>TARGET_OUT_DATA </dt>
<dd>data文件路径 out/target/product/generic/data</dd>
</dl>

<dl>
<dt>$(TARGET_OUT_DATA)/hw </dt>
<dd>HAL库必须放在out/target/product/generic/system/lib/hw</dd>
</dl>

<h3 id="toc_1.2.2">编译动作</h3>
<dl>
<dt>include $(BUILD_EXECUTABLE) </dt>
<dd>创建可执行文件</dd>
</dl>

<dl>
<dt>include $(BUILD_SHARED_LIBRARY) </dt>
<dd>创建动态链接库</dd>
</dl>

<dl>
<dt>include $(BUILD_STATIC_LIBRARY) </dt>
<dd>创建静态链接库</dd>
</dl>

<h2 id="toc_1.3">编译Java模块</h2>
<dl>
<dt>LOCAL_SRC_FILES := $(call all-subdir-java-files) </dt>
<dd>包含所有java源文件</dd>
</dl>

<dl>
<dt>LOCAL_MODULE := </dt>
<dd>模块名称</dd>
</dl>

<dl>
<dt>LOCAL_MODULE_TAGS := eng </dt>
<dd>标示模块信息</dd>
</dl>

<h3 id="toc_1.3.1">编译动作</h3>
<dl>
<dt>include $(BUILD_JAVA_LIBRARY) </dt>
<dd>创建JAR库 </dd>
</dl>

<dl>
<dt>include $(BUILD_MULTI_PREBUILT) </dt>
<dd>多个预编译包</dd>
</dl>

<h2 id="toc_1.4">编译APK</h2>
<dl>
<dt>LOCAL_SRC_FILES := $(call all-subdir-java-files) </dt>
<dd>包含所有java源文件</dd>
</dl>

<dl>
<dt>LOCAL_PACKAGE_NAME := </dt>
<dd>apk名</dd>
</dl>

<dl>
<dt>LOCAL_CERTIFICATE := platform </dt>
<dd>赋予系统级别的权利</dd>
</dl>

<dl>
<dt>LOCAL_JAVA_LIBRARIES := </dt>
<dd>加入的jar包</dd>
</dl>

<dl>
<dt>LOCAL_STATIC_JAVA_LIBRARIES := </dt>
<dd>加入的java库，该库可使用LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES变量指定的jar包进行编译</dd>
</dl>

<dl>
<dt>LOCAL_JNI_SHARED_LIBRARIES := </dt>
<dd>包含jni共享库</dd>
</dl>

<dl>
<dt>include $(BUILD_PACKAGE) </dt>
<dd>创建apk</dd>
</dl>

<h2 id="toc_1.5">示例代码</h2>
<h3 id="toc_1.5.1">编译C静态库</h3>
<pre class="brush:c">
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

LOCAL_MODULE = libhellos
LOCAL_CFLAGS = $(L_CFLAGS)
LOCAL_SRC_FILES = hellos.c
LOCAL_C_INCLUDES = $(INCLUDES)
LOCAL_SHARED_LIBRARIES := \
    libandroid_runtime \
    libnativehelper \
    libcutils \
    libutils \
    libhardware
LOCAL_COPY_HEADERS_TO := libhellos
LOCAL_COPY_HEADERS := hellos.h

include $(BUILD_STATIC_LIBRARY)
</pre>

<h3 id="toc_1.5.2">编译C动态库</h3>
<pre class="brush:c">
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

LOCAL_MODULE = libhellod
LOCAL_CFLAGS = $(L_CFLAGS)
LOCAL_SRC_FILES = hellod.c
LOCAL_C_INCLUDES = $(INCLUDES)
LOCAL_SHARED_LIBRARIES := libcutils
LOCAL_COPY_HEADERS_TO := libhellod
LOCAL_COPY_HEADERS := hellod.h

include $(BUILD_SHARED_LIBRARY)

BUILD_TEST=true
ifeq ($(BUILD_TEST),true)
</pre>

<h3 id="toc_1.5.3">使用C静态库</h3>
<pre class="brush:c">
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

LOCAL_MODULE := hellos
LOCAL_STATIC_LIBRARIES := libhellos
LOCAL_SHARED_LIBRARIES :=
LOCAL_LDLIBS += -ldl
LOCAL_CFLAGS := $(L_CFLAGS)
LOCAL_SRC_FILES := mains.c
LOCAL_C_INCLUDES := $(INCLUDES)

include $(BUILD_EXECUTABLE)
</pre>

<h3 id="toc_1.5.4">使用C动态库</h3>
<pre class="brush:c">
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

LOCAL_MODULE := hellod
LOCAL_MODULE_TAGS := debug
LOCAL_SHARED_LIBRARIES := libc libcutils libhellod
LOCAL_LDLIBS += -ldl
LOCAL_CFLAGS := $(L_CFLAGS)
LOCAL_SRC_FILES := maind.c
LOCAL_C_INCLUDES := $(INCLUDES)

include $(BUILD_EXECUTABLE)
endif # ifeq ($(WPA_BUILD_SUPPLICANT),true)
</pre>

<h3 id="toc_1.5.5">编译Jar库</h3>
<h4 id="toc_1.5.5.1">编译jar库</h4>
<pre class="brush:c">
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

LOCAL_SRC_FILES := \
    $(call all-subdir-java-files) \
    core/java/mokoid/hardware/ILedService.aidl

include $(BUILD_JAVA_LIBRARY)
</pre>

<h4 id="toc_1.5.5.2">需要编写jar包路径的XML</h4>
<pre class="brush:xml">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;permissions&gt;
    &lt;library name="com.mokoid.server" 
             file="/system/framework/mokoid.jar" /&gt;
&lt;/permissions&gt;
</pre>

<ul>
<li>
拷贝xml文件至out/target/product/generic/system/etc/permissions目录
</li>
<li>
使用该jar需要在AndroidManifest.xml中加入以下定义
</li>
</ul>

<pre class="brush:xml">
&lt;use-library android:name="com.mokoid.demo"&gt;
</pre>

<h3 id="toc_1.5.6">编译apk</h3>
<pre class="brush:c">
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

LOCAL_SRC_FILES := $(call all-subdir-java-files)

LOCAL_SRC_FILES := \
    xxx/xxx/xxx.aidl \
    xxx/xxx/xxx.java \
    xxx2/xxx2/xxx2.java

LOCAL_PACKAGE_NAME := Em1NotePad

// 需要权限才能使用系统的服务，如ServiceManager.addService()
LOCAL_CERTIFICATE := platform

LOCAL_JAVA_LIBRARIES := mokoid framework

include $(BUILD_PACKAGE) 
</pre>
<footer>
    <a href="index.html" id="back-home">首页</a>
    <a href="index.html" id="back-about">关于</a>
    <a href="http://www.163.com/" id="back-email">Email</a>
</footer>

</article>
</div>

<!--<script type="text/javascript">-->
<!--var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");-->
<!--document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));-->
<!--</script>-->
<!--<script type="text/javascript">-->
<!--try {-->
<!--var pageTracker = _gat._getTracker("UA-15922433-1");-->
<!--pageTracker._trackPageview();-->
<!--} catch(err) {}-->
<!--</script>-->

</body>
</html>
