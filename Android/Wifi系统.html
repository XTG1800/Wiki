<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Wifi系统</title>
    <!--格式化代码的特效脚本-->
    <script type="text/javascript" src="scripts/shCore.js"></script>
    <script type="text/javascript" src="scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
    <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
    <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
    <script type="text/javascript" src="scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
    <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
    <script type="text/javascript" src="scripts/shBrushScala.js"></script>
    <script type="text/javascript" src="scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="scripts/shBrushVb.js"></script>
    <script type="text/javascript" src="scripts/shBrushXml.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/shCoreZenki.css"/>
    <link type="text/css" rel="stylesheet" href="styles/shThemeZenki.css"/>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
	<link type="text/css" rel="stylesheet" href="css_style/style_zenki.css"/>

</head>

<body>
<div id="wrapper">
<header>

<div id="logo">
</div>

<nav>
    <ul>
        <!--<li class="first"><a href="diary/diary.html">日记</a></li>-->
     </ul>
</nav>
</header>

<article>


<h1 id="toc_1">Wifi系统(ICS 4.0)</h1>

<div class="toc">
<ul>
<li><a href="#toc_1">Wifi系统(ICS 4.0)</a></li>
<ul>
<li><a href="#toc_1.1">概述</a></li>
<li><a href="#toc_1.2">结构图</a></li>
<li><a href="#toc_1.3">应用层控制</a></li>
<li><a href="#toc_1.4">Java层服务</a></li>
<ul>
<li><a href="#toc_1.4.1">WifiManager（Java层高阶API）</a></li>
<li><a href="#toc_1.4.2">WifiService（Java层核心服务类）</a></li>
</ul>
<li><a href="#toc_1.5">JNI接口和硬件抽象层</a></li>
<ul>
<li><a href="#toc_1.5.1">参考代码路径</a></li>
<li><a href="#toc_1.5.2">JNI接口</a></li>
</ul>
<li><a href="#toc_1.6">Wifi硬件抽象层</a></li>
</ul>
</ul>
</div>

<h2 id="toc_1.1">概述</h2>
<pre class="brush:text">
    参考Wifi的框架结构图，在Framework层将Wifi从横向分为4部分：
    1.应用层控制：包含WifiSettings、WifiEnabler、WifiLayer等。该层主要完成Wifi功能的启停、热点的扫描和连接等功能的用户层接口。
    2.Framework-Java层服务：WifiManager、WifiService、WifiStateMachine、WifiMonitor等。该层主要为应用层提供相应功能的接口。
    3.Framework-C++层控制端：android_net_wifi_wifi、wifi等。该层主要为Java层提供操作接口，并作为客户端向系统守护进程发送命令。
    4.Framework-守护进程：wpa_supplicant。该层主要和驱动层通讯，从而实现Wifi的功能。
    
    从纵向上分，大概可分为2部分：
    1.开关控制：WifiManager、WifiService。
    2.状态控制：WifiStateTracker、WifiMonitor。
</pre>

<h2 id="toc_1.2">结构图</h2>
<p>
<a href="pic/wifi_framework2.png"><img src="pic/wifi_framework2.png" /></a>
</p>

<h2 id="toc_1.3">应用层控制</h2>

<h2 id="toc_1.4">Java层服务</h2>
<pre class="brush:text">
    Java层的服务通常是我们所说的Service。就Wifi功能模块而言，它的服务端由Java代码实现，
主要分为高阶的API接口类WifiManager和低阶的API接口类WifiService。而核心功能主要包含以下模块：
    1. WifiStateMachine
    2. WifiMonitor
    3. WifiNative
</pre>

<h3 id="toc_1.4.1">WifiManager（Java层高阶API）</h3>
<ul>
<li>
<a href="WifiManager分析.html">WifiManager分析</a>
</li>
</ul>

<h3 id="toc_1.4.2">WifiService（Java层核心服务类）</h3>
<ul>
<li>
<a href="WifiService分析.html">WifiService分析</a>
</li>
</ul>

<h2 id="toc_1.5">JNI接口和硬件抽象层</h2>
<ul>
<li>
JNI接口和硬件抽象层是C/C++代码实现的底层调用接口，这两部分主要是为Java层的WifiNative类提供方法实现。
</li>
<ul>
<li>
JNI接口的实现由<code>android_net_wifi_Wifi.cpp</code>实现，它和其他JNI方法一起被编译成libandroid_runtime.so。
</li>
<li>
硬件抽象层的实现主要是<code>wifi.c</code>，它会被编译成libnetutils.so。
</li>
<li>
libandroid_runtime.so的编译需要包含libnetutils.so。
</li>
</ul>
</ul>

<h3 id="toc_1.5.1">参考代码路径</h3>
<pre class="brush:text">
frameworks/base/core/jni/android_net_wifi_Wifi.cpp
hardware/libhardware_legacy/wifi/Wifi.c
</pre>

<h3 id="toc_1.5.2">JNI接口</h3>
<ul>
<li>
JNI接口相对比较简单，它是对libnetutils.so提供的方法的包装，再提供给Java层的WifiNative类使用。
</li>
<li>
以下列出了部分JNI方法：
</li>
</ul>

<pre class="brush:c++">
static JNINativeMethod gWifiMethods[] = {
    { "loadDriver", "()Z",  (void *)android_net_wifi_loadDriver },
    { "isDriverLoaded", "()Z",  (void *)android_net_wifi_isDriverLoaded},
    { "unloadDriver", "()Z",  (void *)android_net_wifi_unloadDriver },
    { "startSupplicant", "()Z",  (void *)android_net_wifi_startSupplicant },
    { "startP2pSupplicant", "()Z",  (void *)android_net_wifi_startP2pSupplicant },
    { "stopSupplicant", "()Z", (void*) android_net_wifi_stopSupplicant },
    { "killSupplicant", "()Z",  (void *)android_net_wifi_killSupplicant },
    { "connectToSupplicant", "()Z",  (void *)android_net_wifi_connectToSupplicant },
    { "closeSupplicantConnection", "()V",  (void *)android_net_wifi_closeSupplicantConnection },
    // ......
}
</pre>

<h2 id="toc_1.6">Wifi硬件抽象层</h2>
<ul>
<li>
<a href="Wifi硬件抽象层分析.html">Wifi硬件抽象层分析</a>
</li>
</ul>
<footer>
    <a href="index.html" id="back-home">首页</a>
    <a href="index.html" id="back-about">关于</a>
    <a href="http://www.163.com/" id="back-email">Email</a>
</footer>

</article>
</div>

<!--<script type="text/javascript">-->
<!--var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");-->
<!--document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));-->
<!--</script>-->
<!--<script type="text/javascript">-->
<!--try {-->
<!--var pageTracker = _gat._getTracker("UA-15922433-1");-->
<!--pageTracker._trackPageview();-->
<!--} catch(err) {}-->
<!--</script>-->

</body>
</html>
