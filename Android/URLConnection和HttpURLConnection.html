<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>URLConnection和HttpURLConnection</title>
    <!--格式化代码的特效脚本-->
    <script type="text/javascript" src="scripts/shCore.js"></script>
    <script type="text/javascript" src="scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
    <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
    <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
    <script type="text/javascript" src="scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
    <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
    <script type="text/javascript" src="scripts/shBrushScala.js"></script>
    <script type="text/javascript" src="scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="scripts/shBrushVb.js"></script>
    <script type="text/javascript" src="scripts/shBrushXml.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/shCoreZenki.css"/>
    <link type="text/css" rel="stylesheet" href="styles/shThemeZenki.css"/>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
	<link type="text/css" rel="stylesheet" href="css_style/style_zenki.css"/>

</head>

<body>
<div id="wrapper">
<header>

<div id="logo">
</div>

<nav>
    <ul>
        <!--<li class="first"><a href="diary/diary.html">日记</a></li>-->
     </ul>
</nav>
</header>

<article>


<h1 id="toc_1">URLConnection和HttpURLConnection实现代码</h1>

<div class="toc">
<ul>
<li><a href="#toc_1">URLConnection和HttpURLConnection实现代码</a></li>
<ul>
<li><a href="#toc_1.1">相关类</a></li>
<li><a href="#toc_1.2">流程说明</a></li>
<ul>
<li><a href="#toc_1.2.1">例程源码(JAVA)</a></li>
</ul>
<li><a href="#toc_1.3">用WebView实现</a></li>
<ul>
<li><a href="#toc_1.3.1">相关类</a></li>
<li><a href="#toc_1.3.2">例程源码(JAVA)</a></li>
<li><a href="#toc_1.3.3">例程源码(XML) --- layout</a></li>
<li><a href="#toc_1.3.4">例程源码(XML) --- Manifest</a></li>
<li><a href="#toc_1.3.5">例程源码(JAVA) --- loadData方式</a></li>
</ul>
</ul>
</ul>
</div>

<h2 id="toc_1.1">相关类</h2>
<pre class="brush:java">
import java.net.URL;
import java.net.URLConnection;
import java.net.HttpURLConnection;
import java.io.OutputStream;
import java.io.ObjectOutputStream;
import java.io.BufferedReader;
import java.io.InputStreamReader;
</pre>

<h2 id="toc_1.2">流程说明</h2>
<ul>
<li>
新建URL实例，并获取一个URLConnection对象
</li>
<li>
将Stream转换成Reader进行数据读取
</li>
</ul>

<h3 id="toc_1.2.1">例程源码(JAVA)</h3>
<pre class="brush:java">
String uriAPI = "http://www.dubblogs.cc:8751/Android/Test/API/YamWeather/";
String inputLine;
String uriPic = "";

// 获取图片路径的URL
URL objURL = new URL(uriAPI);

// 取得连接
URLConnection conn = objURL.openConnection();
// 设置连接参数
conn.setConnectTimeout(10000); 
conn.addRequestProperty("User-Agent", "J2me/MIDP2.0"); 
conn.connect();

// 向服务器发送数据
OutputStream outStream = conn.getOutputStream();   
ObjectOutputStream objOutput = new ObjectOutputStream(outStream);   
objOutput.writeObject(new String("this is a string..."));
objOutput.flush(); 

// 从服务器读数据，将InputStream转成Reader 
BufferedReader in = new BufferedReader(
                    new InputStreamReader(
                    conn.getInputStream()));
// 一行一行读取
while ((inputLine = in.readLine()) != null) {
    uriPic += inputLine;
}

// 关闭Reader
in.close();

// 获取图片数据的URL
objURL = new URL(uriPic);

// 取得连接
HttpURLConnection conn2 = (HttpURLConnection) objURL.openConnection();
conn2.connect();

// 取得返回的InputStream
InputStream is = conn2.getInputStream();

// 将InputStream变成Bitmap
Bitmap bm = BitmapFactory.decodeStream(is);

// 关闭InputStream
is.close();

// 会将上面的网络图片显示在 ImageView里面
mImageView1.setImageBitmap(bm);
</pre>

<h2 id="toc_1.3">用WebView实现</h2>

<h3 id="toc_1.3.1">相关类</h3>
<pre class="brush:java">
import android.webkit.WebView;
</pre>

<ul>
<li>
定义WebView控件，并在manifest中加入权限
</li>
<li>
如果需要，在Activity中处理Back事件使浏览器可以退回历史页面
</li>
</ul>

<h3 id="toc_1.3.2">例程源码(JAVA)</h3>
<pre class="brush:java">
@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.main);
    
    // 获取WebView对象
    webview = (WebView) findViewById(R.id.webview); 
    // 使能JavaScript
    webview.getSettings().setJavaScriptEnabled(true); 
    
    webview.loadUrl("http://www.google.com");    
}
</pre>

<h3 id="toc_1.3.3">例程源码(XML) --- layout</h3>
<pre class="brush:xml">
&lt;WebView  
    android:id="@+id/webview" 
    android:layout_width="fill_parent" 
    android:layout_height="fill_parent" 
/&gt;
</pre>

<h3 id="toc_1.3.4">例程源码(XML) --- Manifest</h3>
<pre class="brush:xml">
&lt;uses-permission android:name="android.permission.INTERNET" /&gt;
</pre>

<h3 id="toc_1.3.5">例程源码(JAVA) --- loadData方式</h3>
<pre class="brush:java">
mWebView1.loadData(
    "&lt;html&gt;&lt;body&gt;&lt;p&gt;Subscribe to my Blog&lt;/p&gt;" +
    "&lt;div class='widget-content'&gt; "+
    "&lt;a href=http://www.wretch.cc/blog/blackoa&amp;rss20=1&gt;" +
    "&lt;img src=http://angelosu.googlepages.com/feeds128.png /&gt;" +
    "&lt;a href=http://www.cnblogs.com/tt_mc&gt;Link Blog&lt;/a&gt;" +
    "&lt;/body&gt;&lt;/html&gt;", "text/html", "utf-8");
</pre>
<footer>
    <a href="index.html" id="back-home">首页</a>
    <a href="index.html" id="back-about">关于</a>
    <a href="http://www.163.com/" id="back-email">Email</a>
</footer>

</article>
</div>

<!--<script type="text/javascript">-->
<!--var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");-->
<!--document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));-->
<!--</script>-->
<!--<script type="text/javascript">-->
<!--try {-->
<!--var pageTracker = _gat._getTracker("UA-15922433-1");-->
<!--pageTracker._trackPageview();-->
<!--} catch(err) {}-->
<!--</script>-->

</body>
</html>
