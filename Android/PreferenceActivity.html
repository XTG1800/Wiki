<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>PreferenceActivity</title>
    <!--格式化代码的特效脚本-->
    <script type="text/javascript" src="scripts/shCore.js"></script>
    <script type="text/javascript" src="scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
    <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
    <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
    <script type="text/javascript" src="scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
    <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
    <script type="text/javascript" src="scripts/shBrushScala.js"></script>
    <script type="text/javascript" src="scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="scripts/shBrushVb.js"></script>
    <script type="text/javascript" src="scripts/shBrushXml.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/shCoreZenki.css"/>
    <link type="text/css" rel="stylesheet" href="styles/shThemeZenki.css"/>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
	<link type="text/css" rel="stylesheet" href="css_style/style_zenki.css"/>

</head>

<body>
<div id="wrapper">
<header>

<div id="logo">
</div>

<nav>
    <ul>
        <!--<li class="first"><a href="diary/diary.html">日记</a></li>-->
     </ul>
</nav>
</header>

<article>


<h1 id="toc_1">PreferenceActivity的使用</h1>

<div class="toc">
<ul>
<li><a href="#toc_1">PreferenceActivity的使用</a></li>
<ul>
<li><a href="#toc_1.1">相关类</a></li>
<li><a href="#toc_1.2">使用XML构建</a></li>
<ul>
<li><a href="#toc_1.2.1">示例代码</a></li>
<ul>
<li><a href="#toc_1.2.1.1">XML布局</a></li>
<li><a href="#toc_1.2.1.2">JAVA代码</a></li>
</ul>
</ul>
<li><a href="#toc_1.3">使用代码构建</a></li>
<ul>
<li><a href="#toc_1.3.1">示例代码</a></li>
<ul>
<li><a href="#toc_1.3.1.1">JAVA代码</a></li>
</ul>
</ul>
<li><a href="#toc_1.4">生成的配置文件</a></li>
</ul>
</ul>
</div>

<h2 id="toc_1.1">相关类</h2>
<pre class="brush:java">
import android.app.Activity;

import android.preference.PreferenceActivity;
import android.preference.PreferenceManager;
import android.content.SharedPreferences;
</pre>

<h2 id="toc_1.2">使用XML构建</h2>
<ul>
<li>
使用&lt;PreferenceScreen&gt;设置布局，其中android:key属性用来定义Preference的Key。
</li>
<li>
从PreferenceActivity继承子类，在onCreate()方法中使用<code>addPreferencesFromResource()</code>方法加载布局。
</li>
<li>
<code>SharedPreferences</code>使用参见<a href="持久化.html">持久化</a>
</li>
</ul>

<h3 id="toc_1.2.1">示例代码</h3>
<h4 id="toc_1.2.1.1">XML布局</h4>
<pre class="brush:xml">
&lt;PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android" &gt;

    &lt;intent android:action="android.intent.action.VIEW"
        android:data"http://www.android.com" /&gt;

    &lt;PreferenceCategory android:title="@string/preference_attributes"&gt;
        &lt;CheckBoxPreference
            android:key="key_name"
            android:title="@string/key_title"
            android:summary="@string/key_summary"
            android:defaultValue="true" 
        /&gt;
    &lt;/PreferenceCategory&gt;

    &lt;PreferenceCategory
            android:title="@string/dialog_based_preferences"&gt;
            
        &lt;CheckBoxPreference
                android:key="checkbox_preference"
                android:title="@string/title_toggle_preference"
                android:summary="@string/summary_toggle_preference" /&gt;


        &lt;EditTextPreference
                android:key="edittext_preference"
                android:title="@string/title_edittext_preference"
                android:summary="@string/summary_edittext_preference"
                android:dialogTitle="@string/dialog_title_edittext_preference" /&gt;
                
        &lt;ListPreference
                android:key="list_preference"
                android:title="@string/title_list_preference"
                android:summary="@string/summary_list_preference"
                android:entries="@array/entries_list_preference"
                android:entryValues="@array/entryvalues_list_preference"
                android:dialogTitle="@string/dialog_title_list_preference" /&gt;

        &lt;/PreferenceCategory&gt;
&lt;/PreferenceScreen&gt;
</pre>

<h4 id="toc_1.2.1.2">JAVA代码</h4>
<pre class="brush:java">
public class MyTest extends PreferenceActivity {

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        addPreferencesFromResource(R.xml.setting);
        
        // 获取SharedPreferences引用
        SharedPreferences sp = getPreferenceManager().getDefaultSharedPreferences(this);
    }
}
</pre>

<h2 id="toc_1.3">使用代码构建</h2>
<ul>
<li>
需要从PreferenceActivity类继承
</li>
<li>
在onCreate方法中使用setPreferenceScreen(PreferenceScreen preference)
</li>
</ul>

<h3 id="toc_1.3.1">示例代码</h3>
<h4 id="toc_1.3.1.1">JAVA代码</h4>
<pre class="brush:java">
public class PreferencesFromCode extends PreferenceActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        setPreferenceScreen(createPreferenceHierarchy());
    }

    private PreferenceScreen createPreferenceHierarchy() {
        // Root
        PreferenceScreen root = getPreferenceManager().createPreferenceScreen(this);
        
        // Inline preferences 
        PreferenceCategory inlinePrefCat = new PreferenceCategory(this);
        inlinePrefCat.setTitle(R.string.inline_preferences);
        root.addPreference(inlinePrefCat);
        
        // Toggle preference
        CheckBoxPreference togglePref = new CheckBoxPreference(this);
        togglePref.setKey("toggle_preference");
        togglePref.setTitle(R.string.title_toggle_preference);
        togglePref.setSummary(R.string.summary_toggle_preference);
        inlinePrefCat.addPreference(togglePref);
                
        // Dialog based preferences
        PreferenceCategory dialogBasedPrefCat = new PreferenceCategory(this);
        dialogBasedPrefCat.setTitle(R.string.dialog_based_preferences);
        root.addPreference(dialogBasedPrefCat);

        // Edit text preference
        EditTextPreference editTextPref = new EditTextPreference(this);
        editTextPref.setDialogTitle(R.string.dialog_title_edittext_preference);
        editTextPref.setKey("edittext_preference");
        editTextPref.setTitle(R.string.title_edittext_preference);
        editTextPref.setSummary(R.string.summary_edittext_preference);
        dialogBasedPrefCat.addPreference(editTextPref);
        
        // List preference
        ListPreference listPref = new ListPreference(this);
        listPref.setEntries(R.array.entries_list_preference);
        listPref.setEntryValues(R.array.entryvalues_list_preference);
        listPref.setDialogTitle(R.string.dialog_title_list_preference);
        listPref.setKey("list_preference");
        listPref.setTitle(R.string.title_list_preference);
        listPref.setSummary(R.string.summary_list_preference);
        dialogBasedPrefCat.addPreference(listPref);
        
        return root;
    }
}
</pre>

<h2 id="toc_1.4">生成的配置文件</h2>
<ul>
<li>
查看程序生成的<code>/data/data/[PACKAGE_NAME]/shared_prefs/[PACKAGE_NAME]_preferences.xml</code>参数配置文件。
</li>
</ul>

<pre class="brush:xml">
&lt;?xml version='1.0' encoding='utf-8' standalone='yes' ?&gt;
&lt;map&gt;
&lt;string name="eoe"&gt;book1&lt;/string&gt;
&lt;boolean name="android" value="true" /&gt;
&lt;/map&gt;
</pre>
<footer>
    <a href="index.html" id="back-home">首页</a>
    <a href="index.html" id="back-about">关于</a>
    <a href="http://www.163.com/" id="back-email">Email</a>
</footer>

</article>
</div>

<!--<script type="text/javascript">-->
<!--var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");-->
<!--document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));-->
<!--</script>-->
<!--<script type="text/javascript">-->
<!--try {-->
<!--var pageTracker = _gat._getTracker("UA-15922433-1");-->
<!--pageTracker._trackPageview();-->
<!--} catch(err) {}-->
<!--</script>-->

</body>
</html>
