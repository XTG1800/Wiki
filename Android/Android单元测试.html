<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Android单元测试</title>
    <!--格式化代码的特效脚本-->
    <script type="text/javascript" src="scripts/shCore.js"></script>
    <script type="text/javascript" src="scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCSharp.js"></script>
    <script type="text/javascript" src="scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="scripts/shBrushDelphi.js"></script>
    <script type="text/javascript" src="scripts/shBrushDiff.js"></script>
    <script type="text/javascript" src="scripts/shBrushGroovy.js"></script>
    <script type="text/javascript" src="scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="scripts/shBrushPhp.js"></script>
    <script type="text/javascript" src="scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="scripts/shBrushPlain.js"></script>
    <script type="text/javascript" src="scripts/shBrushRuby.js"></script>
    <script type="text/javascript" src="scripts/shBrushScala.js"></script>
    <script type="text/javascript" src="scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="scripts/shBrushVb.js"></script>
    <script type="text/javascript" src="scripts/shBrushXml.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/shCoreZenki.css"/>
    <link type="text/css" rel="stylesheet" href="styles/shThemeZenki.css"/>
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
    <link rel="Stylesheet" type="text/css" href="../css_style/style_zenki.css">

</head>

<body>
<div id="wrapper">
<header>

<div id="logo">
</div>

<nav>
    <ul>
        <!--<li class="first"><a href="diary/diary.html">日记</a></li>-->
     </ul>
</nav>
</header>

<article>

<!-- wrap the vimwiki html -->

<h1 id="toc_1">编写Android测试程序</h1>

<pre class="brush:java">
import android.test.ActivityInstrumentationTestCase;
</pre>

<h2 id="toc_1.1">基本流程</h2>
<ul>
<li>
生成项目，在项目的根目录新建文件夹tests

<li>
在tests文件夹中生成测试工程，使用<code>android create test-project -m .. -p . -n unittest</code>

<li>
通过继承几个测试类的子类，实现自定义类的测试用例，测试用例的方法以<code>test</code>开头，返回值为<code>public void</code>，并且需要将上一层源代码拷贝到测试工程目录中

<li>
编译测试工程文件，并安装到模拟器中，可以使用<code>adb shell pm list packages</code>查看是否加入了测试程序apk

<li>
<code>adb shell am instrument -w org.example.test.tests/android.test.InstrumentationTestRunner</code>命令来运行测试程序

</ul>

<h2 id="toc_1.2">示例代码</h2>

<h3 id="toc_1.2.1">Manifest配置</h3>
<pre class="brush:xml">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!-- 包名中加入tests以和源工程的包区别开 --&gt;
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
          package="org.example.test.tests"
          android:versionCode="1"
          android:versionName="1.0"&gt;
    &lt;!-- 加入必须的库 --&gt;
    &lt;application&gt;
        &lt;uses-library android:name="android.test.runner" /&gt;
    &lt;/application&gt;
    &lt;!-- name表示执行的测试类，targetPackage表示测试的目标类 --&gt;
    &lt;instrumentation android:name="android.test.InstrumentationTestRunner"
                     android:targetPackage="org.example.test"
                     android:label="Tests for MyTest"/&gt;
&lt;/manifest&gt;
</pre>

<h3 id="toc_1.2.2">测试代码</h3>
<pre class="brush:java">
public class MyTestTest extends ActivityInstrumentationTestCase&lt;MyTest&gt; {

    private MyTest activity = null;

    // 构造方法
    public MyTestTest() {
        super("org.example.test", MyTest.class);
    }

    // 初始化方法
    @Override
    protected void setUp() throws Exception {
        super.setUp();
        // 获取Activity
        activity = getActivity();
    }

    // 测试用例一
    public void testIsFinished() {
        assertTrue("activity is finished", a.isFinishing());
    }

    // 测试用例二
    public void testIsNotFinished() {
        assertEquals(false, !a.isFinishing());
    }
}
</pre>

<h2 id="toc_1.3">运行测试</h2>
<pre class="brush:bash">
# -e class 自定义需要测试的类
# -w 包 / android.test.InstrumentationTestRunner类或继承类名
adb shell am instrument -e class org.example.test.MyTestTest -w org.example.test.tests/android.test.InstrumentationTestRunner
</pre>


<footer>
    <a href="http://zenki2001cn.github.com/Wiki" id="back-home">首页</a>
    <a href="index.html" id="back-about">关于</a>
    <a href="zenki2001cn@163.com" id="back-email">Email</a>
</footer>

</article>
</div>

</body>
</html>
